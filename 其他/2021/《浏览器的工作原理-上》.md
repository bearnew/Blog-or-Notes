# 浏览器的工作原理

## 1.chrome 架构

### 1.chrome 架构

1. `Chrome`,微软 Edge 以及国内的大部分主流浏览器都是基于`Chromium`二次开发而来
2. `Chrome`是`Google`的先行版，特性和`Chromium`基本一样

### 2.进程和线程

1. 1 个进程就是 1 个程序的运行实例
2. 线程是由进程来启动和管理的，进程中使用多线程并行处理能提升运行效率
3. 进程中任一线程执行出错，都会导致整个进程的的崩溃
4. 线程之间共享进程中的数据
5. 进程关闭后，操作系统会回收进程中占用的内存
6. 进行之间的内容是相互隔离的

### 3.单进程浏览器

1. 单进程浏览器是指浏览器的所有功能模块（网络、插件、js 运行环境、渲染引擎、页面等）都是运行在同一个进程里
2. **不稳定**：某个模块崩溃，整个浏览器崩溃
3. **不流畅**: 同一时刻只有一个模块可以执行
4. **不安全**: 运行某个插件，会只有这个插件操作电脑

### 4.多进程浏览器

1. 架构图

- ![JIAGOU](https://github.com/bearnew/picture/blob/master/markdown_v2/2021/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/chrome_%E6%9E%B6%E6%9E%84.PNG?raw=true)

2. 进程相互独立，模块崩溃不会影响整个浏览器
3. js 阻塞了渲染进程，只会影响当前页面。内存泄漏关闭当前页面即可
4. 将插件进程和渲染进程放在安全沙箱中执行，限制他们的系统权限，保证安全性
5. 多进程浏览器会占用更高的内存

### 5.多进程浏览器进程

1. 进程

- ![进程]()

2. **浏览器进程**：主要负责界面显示、用户交互、子进程管理，同时提供存储等功能。
3. **渲染进程**：核心任务是将 html,js,css 转换为用户可以与之交互的网页，排版引擎 Blink 和 js 引擎 v8 都是运行在该进程中，默认情况下，Chrome 会为每个 Tab 标签创建⼀个渲染进程。出
   于安全考虑，渲染进程都是运⾏在沙箱模式下。
4. **GPU 进程**：其实，Chrome 刚开始发布的时候是没有 GPU 进程的。⽽ GPU 的使⽤初衷是为了实现 3D CSS 的
   效果，只是随后⽹⻚、Chrome 的 UI 界⾯都选择采⽤ GPU 来绘制，这使得 GPU 成为浏览器普遍的需求。最
   后，Chrome 在其多进程架构上也引⼊了 GPU 进程。
5. **网络进程**：主要负责⻚⾯的⽹络资源加载，之前是作为⼀个模块运⾏在浏览器进程⾥⾯的，直⾄最近才独
   ⽴出来，成为⼀个单独的进程。
6. **插件进程**： 主要是负责插件的运⾏，因插件易崩溃，所以需要通过插件进程来隔离，以保证插件进程崩溃
   不会对浏览器和⻚⾯造成影响。

### 6.面向服务的架构

1. 每个服务在独立的进程中运行，访问服务必须通过定义好的接口，通过`IPC`来通信，从而构建一个更内聚、松藕性、易于维护和扩展的系统，更好的实现 Chrome 简单、稳定、⾼速、安全的⽬
   标
2. ![service_framework](https://github.com/bearnew/picture/blob/master/markdown_v2/2021/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/next_chrome_framework.PNG?raw=true)
3.

## 2.TCP 协议

1. `FP(First Paint)`：从页面加载到首次开始绘制的时长，受网络加载速度的影响
2. `IP地址`：计算机的地址，主机 A 发送给主机 B，数据包会附带上主机 B 和主机 A 的 IP 信息，包括 IP 版本、源 IP 地址、目标 IP 地址、生存时间等、
3. `UDP`: 将数据包送达应用程序
   - 以 `IP` 通过 `IP` 地址信息把数据包发送给指定的电脑，⽽ `UDP` 通过端⼝号把数据包分发给正确的程序。
   - `UDP`可以校验数据是否正确，无重发机制，失败则丢弃
   - `UDP`不能保证数据可靠性，但传输速度却非常快
   - 大文件拆成小的数据包传输，小的数据包经过不同的路由在不同的时间到达接收端，
4. 网络通信
   - 主机 A 将数据包交给网络层
   - 传输层在数据包前面附加上 UDP 头，组成新的 UDP 包，并交给网络层
   - 网络层将 IP 头附加到数据包，组成新的 IP 数据包，交给底层
   - 底层通过物理网络将数据包传输给主机 B
   - 数据包被传送到主机 B 的网络层，主机 B 拆开数据包的 IP 头信息，将拆开的数据部分交给传输层
   - 在传输层，UDP 头被拆开，根据 UDP 提供的端口号，将数据交给上层的应用程序
   - 主机 B 的上层收到数据包
5. `TCP`
   1. `TCP`是⼀种⾯向连接的、可靠的、基于字节流的传输层通信协议。
   2. 对于数据包丢失的情况，TCP 提供重传机制；
   3. TCP 引⼊了数据包排序机制，⽤来保证把乱序的数据包组合成⼀个完整的⽂件。
   4. 和 UDP 头⼀样，TCP 头除了包含了⽬标端⼝和本机端⼝号外，还提供了⽤于排序的序列号，以便接收端通过序号来重排数据包。
   5. 传输流程
      - 建立连接：三次握手
      - 传输数据：接收端需要对每个数据包进行确认，接收端收到后会发确认数据包给发送端，接收端收到很多小的数据包，会按 TCP 头的序号进行排列，从而保证组成完整的数据
      - 断开连接：四次挥手
6.
